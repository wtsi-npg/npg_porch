<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Porch Tasks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <h3>Porch Tasks</h3>
    <form method="get" action="/">
      <label for="pipeline_selection">Pipeline Selection:</label>
      <select class="form-select" name="pipeline_name" id="pipeline_selection">
        <option disabled>--Pipeline Selection--</option>
        <option {{ "selected" if not "pipeline_name" in request.query_params.keys() }} value="">All</option>
        {% for pipeline in pipelines %}
          <option {{ "selected" if request.query_params.get("pipeline_name") == pipeline.name }} value={{ pipeline.name }}>{{ pipeline.name }}</option>
        {% endfor %}
      </select>
      <input type="submit" value="Submit">
    </form>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Pipeline Name</th>
          <th scope="col">Pipeline Version</th>
          <th scope="col">Task Input</th>
          <th scope="col">Status</th>
          <th scope="col">Date Created</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
          <tr>
            <td>{{ task.pipeline.name }}</td>
            <td>{{ task.pipeline.version }}</td>
            <td>{{ task.task_input }}</td>
            <td>{{ task.status }}</td>
            <td>{{ task.created.strftime('%d/%m/%y %H:%M:%S') }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if max_page_number > 1 %}
      <nav aria-label="Pagination">
        <ul class="pagination">
          {% if current_page > 3 %}
            <li class="page-item">
              <a class="page-link"
                 href="{{ request.url.include_query_params(page=1) }}"
              >
                1
              </a>
            </li>
          {% endif %}
          {% if current_page > 5 %}
            <li class="page-item">
              <a class="page-link"
                 href="{{ request.url.include_query_params(page=current_page-5) }}"
                 aria-label="Skip-5-pages-left"
              >
                <span aria-hidden="true">&laquo</span>
              </a>
            </li>
          {% endif %}
          {% for p in range(current_page - 2, current_page + 3) %}
            {% if p > 0 and p < max_page_number + 1 %}
              {% if p == current_page %}
                <li class="page-item active" aria-current="page">
              {% else %}
                <li class="page-item">
              {% endif %}
                <a class="page-link"
                   href="{{ request.url.include_query_params(page=p) }}"
                >
                  {{ p }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
          {% if current_page < max_page_number - 4 %}
            <li class="page-item">
              <a class="page-link"
                 href="{{ request.url.include_query_params(page=current_page+5) }}"
                 aria-label="Skip-5-pages-right"
              >
                <span aria-hidden="true">&raquo</span>
              </a>
            </li>
          {% endif %}
          {% if current_page < max_page_number - 2 %}
            <li class="page-item">
              <a class="page-link"
                 href="{{ request.url.include_query_params(page=max_page_number) }}"
              >
                {{ max_page_number }}
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}

    <div class="text-center">Copyright Genome Research Ltd 2025 - version: {{ version }} - <a href="/about">about</a></div>
  </body>
</html>
